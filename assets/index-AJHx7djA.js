import{n as ce,r as c,j as e,P as de,E as pe,u as ue,H as he,g as r,a as me,C as w,B as d,t as N}from"./index-3yd_dm4Y.js";import{P as A,a as I,b as F,R as xe,A as ge,c as fe,d as je,e as ve,f as Ne,g as Se,h as we,i as ye,s as De}from"./index-DfQaVUSW.js";import{R as Ce,D as E,a as O,b as T,c as z,P as ke}from"./PlayerList-B-CNbj7P.js";import{a as be,S as Pe}from"./SupportListWithFilter-OMGYHSZC.js";import{H as Re}from"./Helmet-CxUaRvRG.js";import"./label-sJOf3gfQ.js";import"./useViewport-DFWW1tkK.js";/**
 * @license lucide-react v0.522.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Ie=ce("square-pen",Ae);var Fe="Separator",U="horizontal",Ee=["horizontal","vertical"],L=c.forwardRef((a,p)=>{const{decorative:f,orientation:m=U,...S}=a,x=Oe(m)?m:U,g=f?{role:"none"}:{"aria-orientation":x==="vertical"?x:void 0,role:"separator"};return e.jsx(de.div,{"data-orientation":x,...g,...S,ref:p})});L.displayName=Fe;function Oe(a){return Ee.includes(a)}var Te=L;function ze({className:a,orientation:p="horizontal",decorative:f=!0,...m}){return e.jsx(Te,{"data-slot":"separator",decorative:f,orientation:p,className:pe("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",a),...m})}const _e=()=>{const{t:a}=ue(),p=he(),[f,m]=c.useState(!1),[S,x]=c.useState(!1),[y,g]=c.useState(!1),[D,H]=c.useState(1),[u,v]=c.useState({type:"",deck:null,open:!1}),i=r.chain.get("selected").value(),[h,C]=c.useState(i.supports),[l,k]=c.useState(i.player),[V,B]=c.useState(i.raceFilterCondition||{distanceType:[],grade:[],ground:[]}),[$,M]=c.useState(i.filterRace||{}),[_,b]=c.useState(r.chain.get("myDecks").value()),{db:j}=me();if(!j)return null;const q=j.chain.get("races").value(),W=()=>x(!0),G=()=>x(!1),J=s=>{k(s),i.player=s,r.chain.get("selected").assign(i),r.write(),G()},K=s=>{m(!0),g(!0),H(s)},Q=()=>{m(!1),g(!0)},P=()=>g(!1),X=s=>{const t={...h,[D]:s};C(t),i.supports[D]=s,r.chain.get("selected").assign(i),r.write(),P()},Y=s=>{p(`/support-detail/${s.id}`),P()},R=(s=null)=>{let t={imgUrls:[],supportsId:[]};l!=null&&l.id&&(t.playerId=l.id,t.imgUrls.push(l.imgUrl)),[0,1,2,3,4,5].forEach(o=>{var n;(n=h[o])!=null&&n.id?(t.imgUrls.push(h[o].imgUrl),t.supportsId.push(h[o].id)):t.supportsId.push(null)}),s?(r.chain.get("myDecks").find({id:s.id}).assign(t),r.write(),N.info("卡组已更新")):(t.id=De.generate(),r.chain.get("myDecks").push(t),r.write(),N.info("新卡组已保存")),b([...r.chain.get("myDecks").value()])},Z=s=>{i.supports={0:{},1:{},2:{},3:{},4:{},5:{}},i.player={},s.playerId&&(i.player=j.chain.get("players").find({id:s.playerId}).value()),k(i.player),s.supportsId.forEach((t,o)=>{t&&(i.supports[o]=j.chain.get("supports").find({id:t}).value())}),C({...i.supports}),j.chain.get("selected").assign(i),r.write(),N.info("卡组已加载")},ee=s=>{r.chain.get("myDecks").remove({id:s.id}),r.write(),b([...r.chain.get("myDecks").value()]),N.info("卡组已删除")},se=()=>{switch(u.type){case"save":R(u.deck);break;case"delete":ee(u.deck);break}v({...u,open:!1})},te=s=>{B(s);let t=Object.values(s).some(n=>n.length>0)?Object.entries(s).filter(([,n])=>n.length>0).reduce((n,[le,ne])=>n.filter(oe=>ne.includes(oe[le])),q):[],o={};for(let n of t)o[n.dateNum]?o[n.dateNum].push(n.id):o[n.dateNum]=[n.id];M(o),i.raceFilterCondition=s,i.filterRace=o,r.chain.get("selected").assign(i),r.write()},ae=s=>p(`/support-detail/${s}`),ie=s=>p(`/player-detail/${s}/1`),re=()=>p("/buff");return e.jsxs(e.Fragment,{children:[e.jsx(Re,{children:e.jsx("title",{children:"育成 - 乌拉拉大胜利 - 赛马娘资料站"})}),e.jsxs("div",{className:"flex flex-col items-center gap-4 p-4",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full",children:[(l==null?void 0:l.imgUrl)&&e.jsx("img",{src:w+l.imgUrl,alt:l.imgUrl,className:"w-32 h-32 object-cover rounded-md cursor-pointer",onClick:()=>ie(l.id)}),e.jsxs("div",{className:"flex flex-wrap gap-2 flex-1",children:[e.jsx(d,{variant:"outline",onClick:W,children:a("选择马娘")}),e.jsx(d,{variant:"outline",onClick:Q,children:a("支援卡查询")}),e.jsx(d,{variant:"outline",onClick:re,children:a("BUFF")}),e.jsxs(A,{children:[e.jsx(I,{asChild:!0,children:e.jsx(d,{children:a("比赛")})}),e.jsx(F,{className:"w-80",children:e.jsx(xe,{onChange:te,raceFilterCondition:V})})]}),e.jsxs(A,{children:[e.jsx(I,{asChild:!0,children:e.jsx(d,{children:a("我的卡组")})}),e.jsx(F,{className:"w-full max-w-2xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{variant:"outline",onClick:()=>R(),children:a("保存为新卡组")}),e.jsx("div",{className:"space-y-2",children:_.map(s=>e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:s.imgUrls.map(t=>e.jsx("img",{src:w+t,alt:t,className:"w-12 h-12 object-cover rounded"},t))}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>Z(s),children:a("读取")}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>v({type:"save",deck:s,open:!0}),children:a("覆盖")}),e.jsx(d,{variant:"destructive",size:"sm",onClick:()=>v({type:"delete",deck:s,open:!0}),children:a("删除")})]})]},s.id))})]})})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 w-full",children:[0,1,2,3,4,5].map(s=>{var t;return e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>K(s),className:"w-full",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),a("选择支援卡")]}),((t=h[s])==null?void 0:t.id)&&e.jsx("img",{src:w+h[s].imgUrl,alt:h[s].name,className:"w-full h-auto rounded-md cursor-pointer",onClick:()=>ae(h[s].id)})]},s)})}),e.jsx(ze,{className:"my-4"}),e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:a("比赛")}),e.jsx(be,{className:"h-[400px] w-full border rounded p-4",children:e.jsx(Ce,{raceList:l==null?void 0:l.raceList,filterRace:$})})]})]}),e.jsx(E,{open:S,onOpenChange:x,children:e.jsxs(O,{className:"max-w-[90vw] h-[80vh]",children:[e.jsx(T,{children:e.jsx(z,{children:a("选择马娘")})}),e.jsx(ke,{sortFlag:!0,onClick:J})]})}),e.jsx(E,{open:y,onOpenChange:g,children:e.jsxs(O,{className:"max-w-[90vw] h-[80vh]",children:[e.jsx(T,{children:e.jsx(z,{children:a("选择支援卡")})}),e.jsx(Pe,{formName:"nurSupMo",onClick:f?X:Y,sortFlag:!0})]})}),e.jsx(ge,{open:u.open,onOpenChange:s=>v({...u,open:s}),children:e.jsxs(fe,{children:[e.jsxs(je,{children:[e.jsx(ve,{children:"确认操作"}),e.jsxs(Ne,{children:[u.type==="save"&&"确认覆盖此卡组？",u.type==="delete"&&"确认删除此卡组？"]})]}),e.jsxs(Se,{children:[e.jsx(we,{children:"取消"}),e.jsx(ye,{onClick:se,children:"确认"})]})]})})]})};export{_e as default};
