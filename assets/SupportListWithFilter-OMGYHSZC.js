import{r as c,w as k,p as me,j as n,s as be,P as W,y as I,x as D,ae as _,ab as pe,E as Q,u as Z,R as Se,a as ee,ai as ve,g as Y,B as V}from"./index-3yd_dm4Y.js";import{e as xe,D as we,a as ge,b as Ce,c as Pe,h as Ee}from"./PlayerList-B-CNbj7P.js";import{a as Re,I as ye,S as je,u as Te}from"./useViewport-DFWW1tkK.js";import{L as H,C as q}from"./label-sJOf3gfQ.js";function Ae(e,o){return c.useReducer((r,s)=>o[r][s]??r,e)}var X="ScrollArea",[te,Je]=be(X),[Le,T]=te(X),re=c.forwardRef((e,o)=>{const{__scopeScrollArea:r,type:s="hover",dir:t,scrollHideDelay:l=600,...a}=e,[i,d]=c.useState(null),[f,u]=c.useState(null),[m,h]=c.useState(null),[p,R]=c.useState(null),[v,S]=c.useState(null),[g,C]=c.useState(0),[y,P]=c.useState(0),[j,A]=c.useState(!1),[x,E]=c.useState(!1),b=k(o,N=>d(N)),w=me(t);return n.jsx(Le,{scope:r,type:s,dir:w,scrollHideDelay:l,scrollArea:i,viewport:f,onViewportChange:u,content:m,onContentChange:h,scrollbarX:p,onScrollbarXChange:R,scrollbarXEnabled:j,onScrollbarXEnabledChange:A,scrollbarY:v,onScrollbarYChange:S,scrollbarYEnabled:x,onScrollbarYEnabledChange:E,onCornerWidthChange:C,onCornerHeightChange:P,children:n.jsx(W.div,{dir:w,...a,ref:b,style:{position:"relative","--radix-scroll-area-corner-width":g+"px","--radix-scroll-area-corner-height":y+"px",...e.style}})})});re.displayName=X;var oe="ScrollAreaViewport",ne=c.forwardRef((e,o)=>{const{__scopeScrollArea:r,children:s,nonce:t,...l}=e,a=T(oe,r),i=c.useRef(null),d=k(o,i,a.onViewportChange);return n.jsxs(n.Fragment,{children:[n.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:t}),n.jsx(W.div,{"data-radix-scroll-area-viewport":"",...l,ref:d,style:{overflowX:a.scrollbarXEnabled?"scroll":"hidden",overflowY:a.scrollbarYEnabled?"scroll":"hidden",...e.style},children:n.jsx("div",{ref:a.onContentChange,style:{minWidth:"100%",display:"table"},children:s})})]})});ne.displayName=oe;var L="ScrollAreaScrollbar",le=c.forwardRef((e,o)=>{const{forceMount:r,...s}=e,t=T(L,e.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:a}=t,i=e.orientation==="horizontal";return c.useEffect(()=>(i?l(!0):a(!0),()=>{i?l(!1):a(!1)}),[i,l,a]),t.type==="hover"?n.jsx(Ne,{...s,ref:o,forceMount:r}):t.type==="scroll"?n.jsx(_e,{...s,ref:o,forceMount:r}):t.type==="auto"?n.jsx(se,{...s,ref:o,forceMount:r}):t.type==="always"?n.jsx($,{...s,ref:o}):null});le.displayName=L;var Ne=c.forwardRef((e,o)=>{const{forceMount:r,...s}=e,t=T(L,e.__scopeScrollArea),[l,a]=c.useState(!1);return c.useEffect(()=>{const i=t.scrollArea;let d=0;if(i){const f=()=>{window.clearTimeout(d),a(!0)},u=()=>{d=window.setTimeout(()=>a(!1),t.scrollHideDelay)};return i.addEventListener("pointerenter",f),i.addEventListener("pointerleave",u),()=>{window.clearTimeout(d),i.removeEventListener("pointerenter",f),i.removeEventListener("pointerleave",u)}}},[t.scrollArea,t.scrollHideDelay]),n.jsx(I,{present:r||l,children:n.jsx(se,{"data-state":l?"visible":"hidden",...s,ref:o})})}),_e=c.forwardRef((e,o)=>{const{forceMount:r,...s}=e,t=T(L,e.__scopeScrollArea),l=e.orientation==="horizontal",a=U(()=>d("SCROLL_END"),100),[i,d]=Ae("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return c.useEffect(()=>{if(i==="idle"){const f=window.setTimeout(()=>d("HIDE"),t.scrollHideDelay);return()=>window.clearTimeout(f)}},[i,t.scrollHideDelay,d]),c.useEffect(()=>{const f=t.viewport,u=l?"scrollLeft":"scrollTop";if(f){let m=f[u];const h=()=>{const p=f[u];m!==p&&(d("SCROLL"),a()),m=p};return f.addEventListener("scroll",h),()=>f.removeEventListener("scroll",h)}},[t.viewport,l,d,a]),n.jsx(I,{present:r||i!=="hidden",children:n.jsx($,{"data-state":i==="hidden"?"hidden":"visible",...s,ref:o,onPointerEnter:D(e.onPointerEnter,()=>d("POINTER_ENTER")),onPointerLeave:D(e.onPointerLeave,()=>d("POINTER_LEAVE"))})})}),se=c.forwardRef((e,o)=>{const r=T(L,e.__scopeScrollArea),{forceMount:s,...t}=e,[l,a]=c.useState(!1),i=e.orientation==="horizontal",d=U(()=>{if(r.viewport){const f=r.viewport.offsetWidth<r.viewport.scrollWidth,u=r.viewport.offsetHeight<r.viewport.scrollHeight;a(i?f:u)}},10);return O(r.viewport,d),O(r.content,d),n.jsx(I,{present:s||l,children:n.jsx($,{"data-state":l?"visible":"hidden",...t,ref:o})})}),$=c.forwardRef((e,o)=>{const{orientation:r="vertical",...s}=e,t=T(L,e.__scopeScrollArea),l=c.useRef(null),a=c.useRef(0),[i,d]=c.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),f=ue(i.viewport,i.content),u={...s,sizes:i,onSizesChange:d,hasThumb:f>0&&f<1,onThumbChange:h=>l.current=h,onThumbPointerUp:()=>a.current=0,onThumbPointerDown:h=>a.current=h};function m(h,p){return ze(h,a.current,i,p)}return r==="horizontal"?n.jsx(De,{...u,ref:o,onThumbPositionChange:()=>{if(t.viewport&&l.current){const h=t.viewport.scrollLeft,p=J(h,i,t.dir);l.current.style.transform=`translate3d(${p}px, 0, 0)`}},onWheelScroll:h=>{t.viewport&&(t.viewport.scrollLeft=h)},onDragScroll:h=>{t.viewport&&(t.viewport.scrollLeft=m(h,t.dir))}}):r==="vertical"?n.jsx(Oe,{...u,ref:o,onThumbPositionChange:()=>{if(t.viewport&&l.current){const h=t.viewport.scrollTop,p=J(h,i);l.current.style.transform=`translate3d(0, ${p}px, 0)`}},onWheelScroll:h=>{t.viewport&&(t.viewport.scrollTop=h)},onDragScroll:h=>{t.viewport&&(t.viewport.scrollTop=m(h))}}):null}),De=c.forwardRef((e,o)=>{const{sizes:r,onSizesChange:s,...t}=e,l=T(L,e.__scopeScrollArea),[a,i]=c.useState(),d=c.useRef(null),f=k(o,d,l.onScrollbarXChange);return c.useEffect(()=>{d.current&&i(getComputedStyle(d.current))},[d]),n.jsx(ae,{"data-orientation":"horizontal",...t,ref:f,sizes:r,style:{bottom:0,left:l.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:l.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":M(r)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.x),onDragScroll:u=>e.onDragScroll(u.x),onWheelScroll:(u,m)=>{if(l.viewport){const h=l.viewport.scrollLeft+u.deltaX;e.onWheelScroll(h),he(h,m)&&u.preventDefault()}},onResize:()=>{d.current&&l.viewport&&a&&s({content:l.viewport.scrollWidth,viewport:l.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:F(a.paddingLeft),paddingEnd:F(a.paddingRight)}})}})}),Oe=c.forwardRef((e,o)=>{const{sizes:r,onSizesChange:s,...t}=e,l=T(L,e.__scopeScrollArea),[a,i]=c.useState(),d=c.useRef(null),f=k(o,d,l.onScrollbarYChange);return c.useEffect(()=>{d.current&&i(getComputedStyle(d.current))},[d]),n.jsx(ae,{"data-orientation":"vertical",...t,ref:f,sizes:r,style:{top:0,right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":M(r)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.y),onDragScroll:u=>e.onDragScroll(u.y),onWheelScroll:(u,m)=>{if(l.viewport){const h=l.viewport.scrollTop+u.deltaY;e.onWheelScroll(h),he(h,m)&&u.preventDefault()}},onResize:()=>{d.current&&l.viewport&&a&&s({content:l.viewport.scrollHeight,viewport:l.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:F(a.paddingTop),paddingEnd:F(a.paddingBottom)}})}})}),[ke,ce]=te(L),ae=c.forwardRef((e,o)=>{const{__scopeScrollArea:r,sizes:s,hasThumb:t,onThumbChange:l,onThumbPointerUp:a,onThumbPointerDown:i,onThumbPositionChange:d,onDragScroll:f,onWheelScroll:u,onResize:m,...h}=e,p=T(L,r),[R,v]=c.useState(null),S=k(o,b=>v(b)),g=c.useRef(null),C=c.useRef(""),y=p.viewport,P=s.content-s.viewport,j=_(u),A=_(d),x=U(m,10);function E(b){if(g.current){const w=b.clientX-g.current.left,N=b.clientY-g.current.top;f({x:w,y:N})}}return c.useEffect(()=>{const b=w=>{const N=w.target;(R==null?void 0:R.contains(N))&&j(w,P)};return document.addEventListener("wheel",b,{passive:!1}),()=>document.removeEventListener("wheel",b,{passive:!1})},[y,R,P,j]),c.useEffect(A,[s,A]),O(R,x),O(p.content,x),n.jsx(ke,{scope:r,scrollbar:R,hasThumb:t,onThumbChange:_(l),onThumbPointerUp:_(a),onThumbPositionChange:A,onThumbPointerDown:_(i),children:n.jsx(W.div,{...h,ref:S,style:{position:"absolute",...h.style},onPointerDown:D(e.onPointerDown,b=>{b.button===0&&(b.target.setPointerCapture(b.pointerId),g.current=R.getBoundingClientRect(),C.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),E(b))}),onPointerMove:D(e.onPointerMove,E),onPointerUp:D(e.onPointerUp,b=>{const w=b.target;w.hasPointerCapture(b.pointerId)&&w.releasePointerCapture(b.pointerId),document.body.style.webkitUserSelect=C.current,p.viewport&&(p.viewport.style.scrollBehavior=""),g.current=null})})})}),z="ScrollAreaThumb",ie=c.forwardRef((e,o)=>{const{forceMount:r,...s}=e,t=ce(z,e.__scopeScrollArea);return n.jsx(I,{present:r||t.hasThumb,children:n.jsx(He,{ref:o,...s})})}),He=c.forwardRef((e,o)=>{const{__scopeScrollArea:r,style:s,...t}=e,l=T(z,r),a=ce(z,r),{onThumbPositionChange:i}=a,d=k(o,m=>a.onThumbChange(m)),f=c.useRef(void 0),u=U(()=>{f.current&&(f.current(),f.current=void 0)},100);return c.useEffect(()=>{const m=l.viewport;if(m){const h=()=>{if(u(),!f.current){const p=Fe(m,i);f.current=p,i()}};return i(),m.addEventListener("scroll",h),()=>m.removeEventListener("scroll",h)}},[l.viewport,u,i]),n.jsx(W.div,{"data-state":a.hasThumb?"visible":"hidden",...t,ref:d,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...s},onPointerDownCapture:D(e.onPointerDownCapture,m=>{const p=m.target.getBoundingClientRect(),R=m.clientX-p.left,v=m.clientY-p.top;a.onThumbPointerDown({x:R,y:v})}),onPointerUp:D(e.onPointerUp,a.onThumbPointerUp)})});ie.displayName=z;var B="ScrollAreaCorner",de=c.forwardRef((e,o)=>{const r=T(B,e.__scopeScrollArea),s=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&s?n.jsx(We,{...e,ref:o}):null});de.displayName=B;var We=c.forwardRef((e,o)=>{const{__scopeScrollArea:r,...s}=e,t=T(B,r),[l,a]=c.useState(0),[i,d]=c.useState(0),f=!!(l&&i);return O(t.scrollbarX,()=>{var m;const u=((m=t.scrollbarX)==null?void 0:m.offsetHeight)||0;t.onCornerHeightChange(u),d(u)}),O(t.scrollbarY,()=>{var m;const u=((m=t.scrollbarY)==null?void 0:m.offsetWidth)||0;t.onCornerWidthChange(u),a(u)}),f?n.jsx(W.div,{...s,ref:o,style:{width:l,height:i,position:"absolute",right:t.dir==="ltr"?0:void 0,left:t.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function F(e){return e?parseInt(e,10):0}function ue(e,o){const r=e/o;return isNaN(r)?0:r}function M(e){const o=ue(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,s=(e.scrollbar.size-r)*o;return Math.max(s,18)}function ze(e,o,r,s="ltr"){const t=M(r),l=t/2,a=o||l,i=t-a,d=r.scrollbar.paddingStart+a,f=r.scrollbar.size-r.scrollbar.paddingEnd-i,u=r.content-r.viewport,m=s==="ltr"?[0,u]:[u*-1,0];return fe([d,f],m)(e)}function J(e,o,r="ltr"){const s=M(o),t=o.scrollbar.paddingStart+o.scrollbar.paddingEnd,l=o.scrollbar.size-t,a=o.content-o.viewport,i=l-s,d=r==="ltr"?[0,a]:[a*-1,0],f=xe(e,d);return fe([0,a],[0,i])(f)}function fe(e,o){return r=>{if(e[0]===e[1]||o[0]===o[1])return o[0];const s=(o[1]-o[0])/(e[1]-e[0]);return o[0]+s*(r-e[0])}}function he(e,o){return e>0&&e<o}var Fe=(e,o=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},s=0;return function t(){const l={left:e.scrollLeft,top:e.scrollTop},a=r.left!==l.left,i=r.top!==l.top;(a||i)&&o(),r=l,s=window.requestAnimationFrame(t)}(),()=>window.cancelAnimationFrame(s)};function U(e,o){const r=_(e),s=c.useRef(0);return c.useEffect(()=>()=>window.clearTimeout(s.current),[]),c.useCallback(()=>{window.clearTimeout(s.current),s.current=window.setTimeout(r,o)},[r,o])}function O(e,o){const r=_(o);pe(()=>{let s=0;if(e){const t=new ResizeObserver(()=>{cancelAnimationFrame(s),s=window.requestAnimationFrame(r)});return t.observe(e),()=>{window.cancelAnimationFrame(s),t.unobserve(e)}}},[e,r])}var Ie=re,Me=ne,Ue=de;function G({className:e,children:o,...r}){return n.jsxs(Ie,{"data-slot":"scroll-area",className:Q("relative",e),...r,children:[n.jsx(Me,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:o}),n.jsx(Ye,{}),n.jsx(Ue,{})]})}function Ye({className:e,orientation:o="vertical",...r}){return n.jsx(le,{"data-slot":"scroll-area-scrollbar",orientation:o,className:Q("flex touch-none p-px transition-colors select-none",o==="vertical"&&"h-full w-2.5 border-l border-l-transparent",o==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",e),...r,children:n.jsx(ie,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}const K=e=>{const{t:o}=Z(),{onUpdate:r,needId:s,formName:t="sup"}=e,{register:l,watch:a,setValue:i,control:d}=Re();Se.useEffect(()=>{const v=a((S,{name:g,type:C})=>p(S));return()=>v.unsubscribe()},[a]);const{db:f}=ee();if(!f)return null;const u=f.chain.get("supports").value(),m=f.chain.get("effects").value(),h=Object.keys(m).map(v=>({label:m[v].name,value:v})),p=v=>{var j,A;const S=v[`${t}q`],g=v.skill,C=v[`${t}effect`]&&((j=v[`${t}effect`])==null?void 0:j.map(x=>x.replace(t,""))),y=v[`${t}type`]&&((A=v[`${t}type`])==null?void 0:A.map(x=>x.replace(t,"")));let P=[...u];if(y!=null&&y.length&&(P=P.filter(x=>{let E=0;return y.indexOf(x==null?void 0:x.type)!==-1?E=1:E})),C!=null&&C.length&&(P=P.filter(x=>{let E=0;return C.forEach(b=>{x.effects&&x.effects.forEach(w=>{w.type==b&&(E+=1)})}),E===C.length})),g!=null&&g.length&&(P=P.filter(x=>{var b;let E=0;return(b=x.skillList)==null||b.forEach(w=>{if(g.indexOf(w)!==-1)return E=1}),E})),S){const E=f.chain.get("events").value().filter(b=>JSON.stringify(b).indexOf(S)!==-1).reduce((b,w)=>(b.push(w.id),b),[]);P=P.filter(b=>{let w=0;return b.eventList.forEach(N=>{if(E.indexOf(N)!==-1)return w=1}),w})}s&&(P=P.reduce((x,E)=>(x.push(E==null?void 0:E.id),x),[])),r&&r(P)},R=v=>{i("skill",v)};return n.jsxs("div",{className:"flex flex-wrap gap-4",children:[n.jsx("div",{className:"w-full",children:n.jsx(ye,{...l(`${t}q`),placeholder:o("事件关键词搜索")})}),n.jsxs("div",{className:"w-full",children:[n.jsx(H,{className:"text-sm font-medium leading-none",children:o("类型")}),n.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:ve.map(({label:v,value:S})=>n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(q,{id:t+"type"+S,value:t+S,onCheckedChange:g=>{const C=a(`${t}type`)||[];g?i(`${t}type`,[...C,t+S]):i(`${t}type`,C.filter(y=>y!==t+S))}}),n.jsx(H,{htmlFor:t+"type"+S,className:"text-sm font-normal",children:o(v)})]},t+"type"+S))})]}),n.jsxs("div",{className:"w-full",children:[n.jsx(H,{className:"text-sm font-medium leading-none mb-2",children:o("技能筛选")}),n.jsx(je,{formName:t,onUpdate:R,checkOnly:!0,needId:!0})]}),n.jsxs("div",{className:"w-full",children:[n.jsx(H,{className:"text-sm font-medium leading-none",children:o("育成效果")}),n.jsx("div",{className:"mt-2 space-y-2",children:h.map(({label:v,value:S})=>n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(q,{id:t+"effect"+S,value:t+S,onCheckedChange:g=>{const C=a(`${t}effect`)||[];g?i(`${t}effect`,[...C,t+S]):i(`${t}effect`,C.filter(y=>y!==t+S))}}),n.jsx(H,{htmlFor:t+"effect"+S,className:"text-sm font-normal",children:o(v)})]},t+"effect"+S))})]})]})},Ge=e=>{const{onClick:o,limitHeight:r,formName:s}=e,{t}=Z(),l=Te(),[a,i]=c.useState(!1),[d,f]=c.useState(e.supportList||[]),[u,m]=c.useState(!1),[h,p]=c.useState(!1),[R,v]=c.useState(Y.chain.get("mySupports").value()||[]),{db:S}=ee();if(c.useEffect(()=>{S&&f(e.supportList||S.chain.get("supports").value()||[])},[S,e.supportList]),!S)return null;const g=()=>{p(!h),m(!u)},C=()=>{p(!h)},y=P=>{let j=[...R];const A=j.indexOf(P.id);A===-1?j.push(P.id):j.splice(A,1),Y.chain.update("mySupports",j),Y.write(),v([...j])};return n.jsxs("div",{className:"flex flex-col md:flex-row",children:[(l==null?void 0:l.width)>=768?n.jsx("div",{className:"sticky top-20 hidden md:flex w-1/4 flex-col p-1 gap-2",children:n.jsxs(G,{className:"h-[calc(100vh-120px)] pr-3",children:[n.jsx(V,{variant:"outline",onClick:C,children:t(h?"取消高亮":"高亮我的卡组")}),n.jsx(V,{variant:"outline",onClick:g,children:t(u?"配置完成":"配置卡组")}),n.jsx(K,{formName:s,onUpdate:f})]})}):n.jsxs(n.Fragment,{children:[n.jsx(V,{variant:"outline",className:"md:hidden fixed top-20 z-40 bg-background/80 backdrop-blur",onClick:()=>i(!0),children:t("筛选")}),n.jsx(we,{open:a,onOpenChange:i,children:n.jsxs(ge,{className:"sm:max-w-[425px]",children:[n.jsx(Ce,{children:n.jsx(Pe,{children:t("筛选支援卡")})}),n.jsx(K,{formName:s,onUpdate:f})]})})]}),n.jsx("div",{className:`${r?"h-[80vh]":""} ${(l==null?void 0:l.width)>=768?"w-3/4":"w-full"}`,children:n.jsx(G,{className:r?"h-full":"",children:n.jsx(Ee,{className:"justify-between",sortFlag:!0,dataList:d,ownList:h?R:null,onClick:u?y:o})})})]})};export{Ge as S,G as a};
